# Escrow

## Наследование

+ Ownable

## Публичные методы

|Function|Parameters|Return|Description|
|---|---|---|---|
|constructor|address _retailer, uint256 _price, uint256 _amount, address _sdcAddress, address _luvAddress, address _swapAddress|-//-|Во время создания контракта адрес retailer будет установлен в качестве владельца контракта. _price - цена за штуку в LUV. _amount - количество товара. Остальные адреса сохранятся в контракте для взаимодействия в дальнейшем (см. payment)|
|updatePrice|uint256 _newPriceLUV|-//-|Устанавливает новую цену для товара. Может вызываться только владельцем контракта|
|updateAmount|uint32 _newAmount|-//-|Устанавливает новое количество товара. Может вызываться только владельцем контракта|
|getPriceSDC|uint32 _amount|-//-|uint256|Подсчитывает, сколько SDC требуется заплатить за количество товаров (_amount)|
|payment|uint32 _sellAmount, address _from, bytes calldata _sig|-//-|Проводит платёж за товар. На вход передаётся количество товара и данные, необходимые для верификации пользователя. Проверяет, чтобы было достаточно единиц товара (amount)|
|withdraw|-//-|-//-|Переводит средства за платеж со счёта контракта на счёт продавца. Может вызываться только владельцем контракта|
|function () payable|---|---|Fallback функция для получения средств при переводах|
|withdrawEth|---|---|Переводит все средства в ETH на аккаунт владельца. Может вызываться только владельцем контракта|

## Геттеры

|Getter|Type|Description|
|---|---|---|
|id|uint32|ID товара, за которым закреплен контракт|
|price|uint160|Цена в LUV за единицу товара|
|amount|uint32|Количество товара в наличии|
|owner|address|Владелец контракта (продавец)|

## События

|Event|Parameters|Description|
|---|---|---|
|Payment|`address sender` - аккаунт, отправивший платеж, `uint32 id` - id товара в контракте, `uint256 _unitPrice` - цена за штуку товара в LUV, `uint32 _soldAmount` - проданное количество товара, `uint256 _priceSDC` - цена платежа в SDC, `uint256 _priceLUV` - цена платежа в LUV|Событие посылается, когда происходит успешный платеж за товар|

## payment

> uint32 _sellAmount, address _from, bytes calldata _sig
> Пример можно найти в `test/testEscrow.js`
Используется та же схема, что и в approveSig в SDC контракте. Пользователь отправляет транзакцию на сервер, сервер её подписывает и отправляет на контракт, контракт проверяет сигнатуру пользователя и проводит платёж. В качестве получателя средств в сигнатуре должен использоваться адрес Escrow контракта
